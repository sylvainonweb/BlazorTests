@inherits EditablePageComponentBase
@page "/company/add"
@page "/company/edit/{IdAsString}"

@inject CompanyService CompanyService

<EditablePageComponentWrapper Title="@Title" SaveAction="@(() => Save())" CancelAction="@(() => Cancel())">


    <EditForm Model="@Company" OnValidSubmit="@Save">
        <div class="row">
            <div class="col-12">
                <div class="form-group">
                    <label class="col-md-2 col-12">Nom :</label>
                    <InputText Class="col-md-4 col-12" bind-Value="@Company.Name" />
                </div>
            </div>
        </div>
        <DataAnnotationsValidator />
        <ValidationSummary />
    </EditForm>

    @functions {

        BlazorTests.Models.Company Company { get; set; }

        protected override async Task OnInitAsync()
        {
            if (this.Id.HasValue == false)
            {
                this.Title = "Nouvelle société";
                this.Company = new BlazorTests.Models.Company();
            }
            else
            {
                this.Title = "Modifier une société";
                this.Company = await CompanyService.GetCompany(this.Id.Value);
            }
        }

        protected override async Task OnSave()
        {
            if (this.Id.HasValue == false)
            {
                CompanyService.AddCompany(this.Company);
                this.Id = this.Company.Id;
            }
            else
            {
                CompanyService.UpdateCompany(this.Company);
            }

            // On redirige vers la vue complète d'une société
            UriHelper.NavigateTo(Urls.CompanyEditFull + Id);
        }

        protected override async Task OnCancel()
        {
            await ReturnToCallerPage();
        }
    }

</EditablePageComponentWrapper>